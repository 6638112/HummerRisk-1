
ALTER TABLE `rule_group` ADD `type` varchar(64) DEFAULT 'cloud' COMMENT '规则组类别';

INSERT INTO `plugin` ( `id`, `name`, `icon`, `update_time`, `scan_type`, `order_`, `type`) values ('hummer-server-plugin', '主机检测', 'server.png', concat(unix_timestamp(now()), '001'), 'server', 23, 'server');

UPDATE `rule_group` SET `type` = 'cloud';

INSERT INTO `rule_group` (`name`, `description`, `level`, `plugin_id`, `flag`, `type`) VALUES ('K8s 内存限制检测', '检测 K8s 资源是否限制内存大小', '安全合规', 'hummer-k8s-plugin', 1, 'k8s');

SELECT @groupId := LAST_INSERT_ID();

INSERT INTO `rule_group` (`name`, `description`, `level`, `plugin_id`, `flag`, `type`) VALUES ('K8s 容器的文件系统检测', '检测 K8s 容器的文件系统是否为只读，如果容器应用程序需要写入文件系统，建议为应用程序需要写访问权限的特定目录挂载辅助文件系统。', '合规检测', 'hummer-k8s-plugin', 1, 'k8s');

SELECT @groupId1 := LAST_INSERT_ID();

INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('2d08f728-f869-4b69-8772-41a8d58b5c34', 'K8s StatefulSet 内存限制检测', 1, 'MediumRisk', '检测 K8s StatefulSet 是否限制内存大小，限制大小视为“合规”，否则视为“不合规”。', 'policies:\n    # 检测 K8s StatefulSet 是否限制内存大小，限制大小视为“合规”，否则视为“不合规”。\n    - name: k8s-stateful-set\n      resource: k8s.stateful-set\n      filters:\n        - type: memory-limit\n          limit_min: ${{value1}}\n          limit_max: ${{value2}}', '[{\"defaultValue\":\"64\",\"name\":\"最小内存限制\",\"key\":\"value1\",\"required\":true},{\"defaultValue\":\"1024\",\"name\":\"最大内存限制\",\"key\":\"value2\",\"required\":true}]', 'hummer-k8s-plugin', 'Kubernetes', 'k8s.png', concat(unix_timestamp(now()), '004'), 1, 'custodian', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('c3959d6f-d5c1-49d9-9f16-bd7f8e359667', 'K8s Pod 内存大小限制检测', 1, 'MediumRisk', '检测 K8s Pod 是否限制内存大小，限制大小视为“合规”，否则视为“不合规”。', 'policies:\n    # 检测 K8s Pod 是否限制内存大小，限制大小视为“合规”，否则视为“不合规”。\n    - name: k8s-pod-memory\n      resource: k8s.pod\n      filters:\n        - type: memory-limit\n          limit_min: ${{value1}}\n          limit_max: ${{value2}}', '[{\"key\":\"value1\",\"name\":\"最小内存限制\",\"defaultValue\":\"64\",\"required\":true},{\"key\":\"value2\",\"name\":\"最大内存限制\",\"defaultValue\":\"1024\",\"required\":true}]', 'hummer-k8s-plugin', 'Kubernetes', 'k8s.png', concat(unix_timestamp(now()), '004'), 1, 'custodian', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('c5544cfe-084a-4947-a075-d607dc705837', 'K8s DaemonSet 内存大小限制检测', 1, 'MediumRisk', '检测 K8s DaemonSet 是否限制内存大小，限制大小视为“合规”，否则视为“不合规”。', 'policies:\n    # 检测 K8s DaemonSet 是否限制内存大小，限制大小视为“合规”，否则视为“不合规”。\n    - name: k8s-daemon-set-memory\n      resource: k8s.daemon-set\n      filters:\n        - type: memory-limit\n          limit_min: ${{value1}}\n          limit_max: ${{value2}}', '[{\"key\":\"value1\",\"name\":\"最小内存限制\",\"defaultValue\":\"64\",\"required\":true},{\"key\":\"value2\",\"name\":\"最大内存限制\",\"defaultValue\":\"1024\",\"required\":true}]', 'hummer-k8s-plugin', 'Kubernetes', 'k8s.png', concat(unix_timestamp(now()), '004'), 1, 'custodian', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('cf01ca4c-c97a-4db6-b90a-830f6d1018ea', 'K8s Deployment 内存限制检测', 1, 'MediumRisk', '检测 K8s Deployment 是否限制内存大小，限制大小视为“合规”，否则视为“不合规”。', 'policies:\n    # 检测 K8s deployment 是否限制内存大小，限制大小视为“合规”，否则视为“不合规”。\n    - name: k8s-deployment-memory\n      resource: k8s.deployment\n      filters:\n        - type: memory-limit\n          limit_min: ${{value1}}\n          limit_max: ${{value2}}', '[{\"key\":\"value1\",\"name\":\"最小内存限制\",\"defaultValue\":\"64\",\"required\":true},{\"key\":\"value2\",\"name\":\"最大内存限制\",\"defaultValue\":\"1024\",\"required\":true}]', 'hummer-k8s-plugin', 'Kubernetes', 'k8s.png', concat(unix_timestamp(now()), '004'), 1, 'custodian', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('fe65831e-25b1-4c5b-a08b-e0bae0d3847b', 'K8s ReplicaSet 内存大小限制检测', 1, 'MediumRisk', '检测 K8s ReplicaSet 是否限制内存大小，限制大小视为“合规”，否则视为“不合规”。', 'policies:\n    # 检测 K8s ReplicaSet 是否限制内存大小，限制大小视为“合规”，否则视为“不合规”。\n    - name: k8s-replica-set-memory\n      resource: k8s.replica-set\n      filters:\n        - type: memory-limit\n          limit_min: ${{value1}}\n          limit_max: ${{value2}}', '[{\"key\":\"value1\",\"name\":\"最小内存限制\",\"defaultValue\":\"64\",\"required\":true},{\"key\":\"value2\",\"name\":\"最大内存限制\",\"defaultValue\":\"1024\",\"required\":true}]', 'hummer-k8s-plugin', 'Kubernetes', 'k8s.png', concat(unix_timestamp(now()), '004'), 1, 'custodian', NULL);

INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('0f2dae7b-da13-4c17-a77d-b2d677b25174', 'K8s Deployment 容器的文件系统只读检测', 1, 'MediumRisk', '检测 K8s Deployment 容器的文件系统是否只读，只读视为“合规”，否则视为“不合规”。', 'policies:\n    # 检测 K8s Deployment 容器的文件系统是否只读，只读视为“合规”，否则视为“不合规”。\n    - name: k8s-deployment-filesystem\n      resource: k8s.deployment\n      filters:\n        - type: filesystem-read-only', '[]', 'hummer-k8s-plugin', 'Kubernetes', 'k8s.png', concat(unix_timestamp(now()), '004'), 1, 'custodian', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('50f5f3b4-8cc0-44fa-8e59-c84b1c4250fe', 'K8s StatefulSet 容器的文件系统只读检测', 1, 'MediumRisk', '检测 K8s StatefulSet 容器的文件系统是否只读，只读视为“合规”，否则视为“不合规”。', 'policies:\n    # 检测 K8s stateful-set 容器的文件系统是否只读，只读视为“合规”，否则视为“不合规”。\n    - name: k8s-stateful-set-filesystem\n      resource: k8s.stateful-set\n      filters:\n        - type: filesystem-read-only', '[]', 'hummer-k8s-plugin', 'Kubernetes', 'k8s.png', concat(unix_timestamp(now()), '004'), 1, 'custodian', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('6adf1612-6016-4a9f-a224-e04fbb78a131', 'K8s DaemonSet 容器的文件系统只读检测', 1, 'MediumRisk', '检测 K8s DaemonSet 容器的文件系统是否只读，只读视为“合规”，否则视为“不合规”。', 'policies:\n    # 检测 K8s daemon-set 容器的文件系统是否只读，只读视为“合规”，否则视为“不合规”。\n    - name: k8s-daemon-set-filesystem\n      resource: k8s.daemon-set\n      filters:\n        - type: filesystem-read-only', '[]', 'hummer-k8s-plugin', 'Kubernetes', 'k8s.png', concat(unix_timestamp(now()), '004'), 1, 'custodian', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('8d00a470-0a17-4eb3-908e-63e0352edec1', 'K8s ReplicaSet 容器的文件系统只读检测', 1, 'MediumRisk', '检测 K8s ReplicaSet 容器的文件系统是否只读，只读视为“合规”，否则视为“不合规”。', 'policies:\n    # 检测 K8s replica-set 容器的文件系统是否只读，只读视为“合规”，否则视为“不合规”。\n    - name: k8s-replica-set-filesystem\n      resource: k8s.replica-set\n      filters:\n        - type: filesystem-read-only', '[]', 'hummer-k8s-plugin', 'Kubernetes', 'k8s.png', concat(unix_timestamp(now()), '004'), 1, 'custodian', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('988037d4-8de7-4664-8775-4fa9a4a5afca', 'K8s Pod 容器的文件系统只读检测', 1, 'MediumRisk', '检测 K8s Pod 容器的文件系统是否只读，只读视为“合规”，否则视为“不合规”。', 'policies:\n    # 检测 K8s Pod 容器的文件系统是否只读，只读视为“合规”，否则视为“不合规”。\n    - name: k8s-pod-filesystem\n      resource: k8s.pod\n      filters:\n        - type: filesystem-read-only', '[]', 'hummer-k8s-plugin', 'Kubernetes', 'k8s.png', concat(unix_timestamp(now()), '004'), 1, 'custodian', NULL);

INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('c3959d6f-d5c1-49d9-9f16-bd7f8e359667', 'cloud native');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('cf01ca4c-c97a-4db6-b90a-830f6d1018ea', 'cloud native');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('2d08f728-f869-4b69-8772-41a8d58b5c34', 'cloud native');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('fe65831e-25b1-4c5b-a08b-e0bae0d3847b', 'cloud native');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('c5544cfe-084a-4947-a075-d607dc705837', 'cloud native');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('988037d4-8de7-4664-8775-4fa9a4a5afca', 'cloud native');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('50f5f3b4-8cc0-44fa-8e59-c84b1c4250fe', 'cloud native');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('6adf1612-6016-4a9f-a224-e04fbb78a131', 'cloud native');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('0f2dae7b-da13-4c17-a77d-b2d677b25174', 'cloud native');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('8d00a470-0a17-4eb3-908e-63e0352edec1', 'cloud native');

INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('0233018a-a9a3-4eb5-94ea-c0b1c337062f', 'c5544cfe-084a-4947-a075-d607dc705837', 'k8s.daemon-set');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('8caaeccb-1a44-44f4-84a2-8aeca4baf984', 'fe65831e-25b1-4c5b-a08b-e0bae0d3847b', 'k8s.replica-set');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('af173498-4c7b-4902-9568-faae49a1296f', '2d08f728-f869-4b69-8772-41a8d58b5c34', 'k8s.stateful-set');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('d17a7300-c0f8-4e03-8200-1e5324c13cd0', 'c3959d6f-d5c1-49d9-9f16-bd7f8e359667', 'k8s.pod');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('d6490bfc-cd35-41ac-9d7b-8723144ccc43', 'cf01ca4c-c97a-4db6-b90a-830f6d1018ea', 'k8s.deployment');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('39217066-f444-4b2f-8077-e6fa28dd69df', '8d00a470-0a17-4eb3-908e-63e0352edec1', 'k8s.replica-set');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('3c79d1e5-6ad5-4c32-a9c1-fca2cad6bfd0', '988037d4-8de7-4664-8775-4fa9a4a5afca', 'k8s.pod');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('6e9f727e-8177-4d38-b54f-b53e55024f3b', '6adf1612-6016-4a9f-a224-e04fbb78a131', 'k8s.daemon-set');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('8e6c0f41-0fd2-469f-a76d-90e448665ac7', '50f5f3b4-8cc0-44fa-8e59-c84b1c4250fe', 'k8s.stateful-set');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('a52808fa-7d43-4aff-9d05-ab66c2108b90', '0f2dae7b-da13-4c17-a77d-b2d677b25174', 'k8s.deployment');

INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('c3959d6f-d5c1-49d9-9f16-bd7f8e359667', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('cf01ca4c-c97a-4db6-b90a-830f6d1018ea', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('2d08f728-f869-4b69-8772-41a8d58b5c34', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('fe65831e-25b1-4c5b-a08b-e0bae0d3847b', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('c5544cfe-084a-4947-a075-d607dc705837', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('988037d4-8de7-4664-8775-4fa9a4a5afca', @groupId1);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('50f5f3b4-8cc0-44fa-8e59-c84b1c4250fe', @groupId1);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('6adf1612-6016-4a9f-a224-e04fbb78a131', @groupId1);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('0f2dae7b-da13-4c17-a77d-b2d677b25174', @groupId1);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('8d00a470-0a17-4eb3-908e-63e0352edec1', @groupId1);